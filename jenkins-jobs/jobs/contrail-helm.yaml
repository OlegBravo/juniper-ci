- job-template:
    name: contrail-helm-{project}
    description: "Deploys Kubernetes plus Contrail in AIO mode in host {project}"
    defaults: global
    properties:
      - build-discarder
    parameters:
      - choice:
          name: CLEAN_ENV
          choices:
            - always
            - on_success
            - never
      - string:
          name: DOCKER_CONTRAIL_URL
          default: https://github/cloudscaling/docker-contrail-4
          description: "change set to cherry pick"
      - string:
          name: OPENSTACK_HELM_URL
          default: https://github.com/cloudscaling/openstack-helm
          description: "change set to cherry pick"
      - string:
          name: CHANGE_REF
          #default: refs/changes/18/514518/41
          description: "change set to cherry pick in case of OpenStack version of openstack-helm. ex: refs/changes/18/514518/41"
    scm:
      - juniper-ci
    builders:
      - shell: |
          #!/bin/bash -e
          ./juniper-ci/contrail-helm/run-{project}.sh
    publishers:
      - archive:
          artifacts: 'logs/**'
          allow-empty: true

- project:
   name: contrail-helm
   project:
    - aws-ubuntu
    - aws-centos
    - server-ubuntu
    - server-centos
   jobs:
    - 'contrail-helm-{project}'
